<?php 

?>
<!DOCTYPE html>
<html dir='rtl'>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width" initial-scale="1.0"/>
        <!--<link rel="stylesheet" href="https://cdn.rtlcss.com/bootstrap/v4.2.1/css/bootstrap.min.css" integrity= "sha384-vus3nQHTD+5mpDiZ4rkEPlnkcyTP+49BhJ4wJeJunw06ZAp+wzzeBPUXr42fi8If"  crossorigin= "anonymous">-->
        <link type="text/css" rel="stylesheet" href="bootstrap.min.css">
        <link rel="stylesheet" href="//cdn.rawgit.com/morteza/bootstrap-rtl/v3.3.4/dist/css/bootstrap-rtl.min.css">

        <link type="text/css" rel="stylesheet" href="floatig-labels.css">
        <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600&display=swap" rel="stylesheet">
    </head>
    <style>
        body{
            background-color:white;
            text-align:right;
        }
    #f{
        font-size:xx-large;
    }
    a{
        color:black;
    }
    a:visited{
        color:black;
    }
    a:hover{
        color:black;
    }
    #views{
        position:relative;
        right:150px;
        font-size:x-small;
    }
    #user{
        font-size:large;
    }
    .text{
        color:gray;
        font-size:large;
        top:50px;
        font-family: 'Cairo', sans-serif;
        width:70px;
    }
    #type{
        font-size:x-small;
        position:relative;
        left:40px;
    }
    #search{
        text-align:center;
        position:asolute;
        left:10px;
        top:70px;
        border:1px solid black;
        font-family: 'Cairo', sans-serif;
        color:black;
        width:300px;
        height:39px;
        border-radius:25px;
        margin-top:70px;
        margin-right:40px;
        outline:none;

    }
    #search::placeholder{
        color:blac
    }
    #sub{
        position:fsd;
        top:0px;
        left:0px;
        border:none;
        border-radius:70px;
        background-color:white;
        color:white;
        outline:none;
    }
    #number{
        font-size:large;
    }
    #user{
        font-size:large;
        font-family: 'Cairo', sans-serif;
    }
    .title{
        font-size:x-large;
        font-family: 'Cairo', sans-serif;
    }
    .img{
        border:2px solid black;
        width:45px;
        height:45px;
        border-radius:30px;
        margin-bottom:5px;
    }
    #container{
        margin-top:40px;
       
    }
    h6{
        font-family: 'Cairo', sans-serif;

    }
    @media only screen and (min-width:160px) and  (max-width: 393px){
        #search{
           border:none;
            margin-right:0px;
            background-color:whitesmoke;
        }
    }
    @media only screen and (min-width:311px) and  (max-width: 344px){
        #search{
            width:260px;
        }
    }
    @media only creen and (min-width:375px) and  (max-width: 420px){
    #search{
        border:none;
            margin-right:10px;
            background-color:whitesmoke;        }
    }
    </style>
    <body>
    
    <div>
    <nav class="navbar navbar-expand-lg " style="background-color:white;display:flex;background: rgba(155,555,555,.8);">
          
          </nav>
          
         
          <nav class="navbar fixed-top "style="background-color:white;display:flex;height:75px;padding-bottom:0px;">
          <a class="navbar-brand" href="#"><img src="IMG_٢٠٢٠٠٧٢٧_٢٣٠٥٣٦.jpg" alt="logo" style="position:relative;top:-11px;width:80px;height:80px;position:asolute;"></a>
                      
            <span style='position:relative;top:-11px;'>
           <a href='factory.php'> <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="47" viewBox="0 0 24 24" width="47"><g><rect fill="none" height="24" width="24"/></g><g><g><path d="M19,9.3V4h-3v2.6L12,3L2,12h3v8h6v-6h2v6h6v-8h3L19,9.3z M17,18h-2v-6H9v6H7v-7.81l5-4.5l5,4.5V18z"/><path d="M10,10h4c0-1.1-0.9-2-2-2S10,8.9,10,10z"/></g></g></svg>
</a>
            </span>
           <!-- <span>
                <svg xmlns="http://www.w3.org/2000/svg" style="color:black;background-color:blac;" width="35" height="40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true" class="mr-2" viewBox="0 0 24 24" focusable="false"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>



            </span>-->
            <span style='position:relative;top:-11px;border-bottom:4px solid black;width:55px;border-radius:0px;height:2p;padding-right:0px;padding-top:7px;'>
            <svg xmlns="http://www.w3.org/2000/svg" height="57" viewBox="0 0 24 24" width="57"><path d="M0 0h24v24H0z" fill="none"/><path d="M11.5 9C10.12 9 9 10.12 9 11.5s1.12 2.5 2.5 2.5 2.5-1.12 2.5-2.5S12.88 9 11.5 9zM20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-3.21 14.21l-2.91-2.91c-.69.44-1.51.7-2.39.7C9.01 16 7 13.99 7 11.5S9.01 7 11.5 7 16 9.01 16 11.5c0 .88-.26 1.69-.7 2.39l2.91 2.9-1.42 1.42z"/></svg>


            </span>
            
           
            <button  class="navbar-toggler p-0 border-0" type="button" data-toggle="offcanvas" style='position:relative;top:-11px;'>
              <div class="navbar-icon" style="color:white;background-color:white;border:2px solid black;border-radius:30px;width:40px;height:0px;"></div>
              <div class="navbar-icon" style="margin-top:9px;color:white;background-color:white;border:2px solid black;border-radius:30px;width:30px;height:0px;"></div>
              <div class="navbar-icon" style="margin-top:9px;color:white;background-color:white;border:2px solid black;border-radius:30px;width:40px;height:0px;"></div>

            </button>




            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                  <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Features</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Pricing</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
                  </li>
                </ul>
              </div>
          </nav>


        <form method="post">
      
 <input type="search" id='search' name="query" placeholder='ابحث في كتابة' >
 

 <button type='submit' id='sub' name='subsearch' >         <svg xmlns='http://www.w3.org/2000/svg' width='35' height='35' viewBox='0 0 512 512'><title>ionicons-v5-f</title><path d='M448,64,64,240.14H264a8,8,0,0,1,8,8V448Z' style='fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px'/></svg>
</button>
 
        
        </form>
</div>
<main role='main' class='container' id='container' >

               
               <h6 class='border-bottom border-gray pb-2 mb-0'>نتائج البحث</h6>
<?php

        class engine{
            public $query;
            



            public function search(){
             
              $conn= mysqli_connect("localhost","fadel2","fadel1234@","new");
              $s= "select * from writings";
              $q= mysqli_query($conn,$s);
              $f=mysqli_fetch_array($q);
                $arr= array();
                $p_arr= array();
                $b_arr= array();
                while($f= mysqli_fetch_array($q)){
                    $f_arr= explode(' ',$f[2]);
                    $q_arr= explode(' ',$this->query);
                    if(count($f_arr) != 0){
                       // echo "true";
                    }
                    else{
                        echo "false";
                    }
                    $n = 0;
                    
                    for($m = 0; $m < count($q_arr); $m++){
                        $in = $q_arr[$m];
                        if(in_array($in, $f_arr)){
                            $n++ ;
                        }
                    }

                        if($n != 0){
                            $b= $f[0];
                            $d= $f[1];
                            $arr[$b] = $n;
                            array_push($arr, $n);  //count appearance
                            array_push($p_arr, $b); // text id
                            array_push($b_arr, $d); // text user id
                        }
                }

                for($i = 0; $i < count($p_arr); $i++){
                    $t_id= $p_arr[$i];
                   // echo $t_id;
                    $p_conn= mysqli_connect("localhost","fadel2","fadel1234@","new");
                    $t_s= "select * from writings where wid=$t_id";
                    $t_q= mysqli_query($p_conn,$t_s);
                    $t_f= mysqli_fetch_array($t_q);
                    $u_id= $t_f[1];
                    $p_s= "select * from user where id=$u_id"; 
                    $p_q= mysqli_query($p_conn,$p_s);
                    $p_f= mysqli_fetch_array($p_q);
                   // echo $p_f[1]; // text user
                   if($p_f[10] == True){
                       $img= '<img class="img" src="data:image/png;base64 , '.base64_encode($p_f[10]).'">';

                   }
                   else{
                       $img= '';
                   }

                    $t_s= "select * from writings where wid=$t_id"; 
                    $t_q= mysqli_query($conn,$t_s);
                    $t_f= mysqli_fetch_array($t_q);
                   
                    $text= $t_f[3];
                    $type= $t_f[4];
                    $views= $t_f[7];
                
                    $title= $t_f[2];

                    echo "
                    
                    
                    <div class='my-3 p-3 b-white rounded shadow-sm'>    
                    <div class='border-bottom' id='user'><p> $img<span><a  href=user.php?id=$p_f[0]> $p_f[1]</a> <div>   <span id='views'>$views<span></span id='number'> مشاهدة </span>  <span id='type'>$type</span>     </div></span>   </p>   </div>  <span></span>
                              <div class='title'> <a href='text.php?tid=$t_f[0]'>$t_f[2]<a></div>
                              <div class='text'> 
                              </div>
                   
                    </div>
                    " ;  // show
                }
               
                echo "</main>";
             // echo '</div>';
                
        }
        
    }
        
$blog= new engine();
@$blog->query= $_POST['query'];

if(isset($_POST['subsearch'])){
    $blog->search();

}

?>        
<script src="jquery-3.4.1.min.js">    
        </script>
        <script src="bootstrap.min.js"></script>
    </body>
</html>